Learning Objectives:-
Create a ConfigMap called `candy-service-config` to store the container's configuration data.
Create a Kubernetes secret called `db-password` to store the database password.
Create the pod for the candy-service application according to the provided specification.

Problem Statement:-
Your company is nearing completion of their new mobile app, a candy-themed game. This application has some backend infrastructure the company plans to run using Kubernetes. They want to begin deploying one of their backend services to the cluster and have asked you to create a pod definition that meets the specifications required by the software. Create a pod definition in /home/cloud_user/candy-service-pod.yml, and then create a pod in the cluster using this definition to make sure it works.

The specifications are as follows:

The current image for the container is linuxacademycontent/candy-service:1. You do not need a custom command or args.
There is some configuration data the container will need:

candy.peppermint.power=100000000
candy.nougat-armor.strength=10

It will expect to find this data in a file at /etc/candy-service/candy.cfg. Store the configuration data in a ConfigMap called
 candy-service-config and provide it to the container as a mounted volume.
The container will need to run with the file system group with the id 2000. You will need to set this using the securityContext.
The container should expect to use 64MiB of memory and 250m CPU (use resource requests).
The container should be limited to 128MiB of memory and 500m CPU (use resource limits).
The container needs access to a database password in order to authenticate with a backend database server. The password is
 Kub3rn3t3sRul3s!. It should be stored in a secure fashion (as a Kubernetes secret called db-password) and passed to the
 container as an environment variable called DB_PASSWORD.

Good luck!


solution:

* create a "candy.cfg"  with content below:

candy.peppermint.power=100000000
candy.nougat-armor.strength=10

*create configmap 

kubectl create configmap candy-service-config --from-file=candy.cfg

*create password file 

echo Kub3rn3t3sRul3s! > password.txt

*make "password.txt" as secret

kubectl create secret generic db-password --from-file=password.txt


* Create a pod definition in /home/cloud_user/candy-deploy-pod.yml

vi candy-deploy-pod.yml


apiVersion: v1
kind: Pod
metadata:
  name: myvolconfig
spec:
  securityContext:
    runAsUser: 2000
    runAsGroup: 2000
  containers:
  - name: c1
    image: linuxacademycontent/candy-service:1
    resources:
      requests:
        memory: "64Mi"
        cpu: "250m"
      limits:
        memory: "128Mi"
        cpu: "500m"
    volumeMounts:
      - name: testconfigmap
        mountPath: "/etc/candy-service/candy.cfg"   # the config files will be mounted as ReadOnly by default here   
   volumes:
   - name: testconfigmap
     configMap:
       name: candy-service-config    # this should match the config map name created in the first step
       items:
       - key: candy.cfg
         path: candy.cfg
    env:
    - name: DB_PASSWORD        # env name in which value of the key is stored
      valueFrom:
        secretKeyRef:
          name: db-password      # name of the config created
          key: password.txt
  securityContext:
      allowPrivilegeEscalation: false


* creation of pod:

kubectl apply -f candy-deploy-pod.yml

